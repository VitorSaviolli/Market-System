================================================================================
                    üõí ROTAS DA API - GUIA DE TESTES
================================================================================
(feito por IA)
(foi usado o Postman para o teste)
BASE URL: http://localhost:8000
================================================================================
                    RODAR API
================================================================================
uvicorn api.main:app --reload
================================================================================
                        üì¶ PRODUTOS (PRODUCTS)
================================================================================

1Ô∏è‚É£ CRIAR PRODUTO
-----------------
M√©todo: POST
URL: http://localhost:8000/products/
Body (JSON):
{
  "name": "Arroz",
  "price": 10.50,
  "stock": 100,
  "description": "Arroz branco tipo 1"
}

Resposta esperada: 201 Created
{
  "id": 1,
  "name": "Arroz",
  "price": 10.5,
  "stock": 100,
  "description": "Arroz branco tipo 1"
}

---

EXEMPLOS ADICIONAIS PARA CRIAR:

Produto 2:
{
  "name": "Feij√£o",
  "price": 8.00,
  "stock": 50,
  "description": "Feij√£o preto"
}

Produto 3:
{
  "name": "A√ß√∫car",
  "price": 5.00,
  "stock": 200,
  "description": "A√ß√∫car cristal"
}

Produto 4:
{
  "name": "Caf√©",
  "price": 12.00,
  "stock": 0,
  "description": "Caf√© torrado e mo√≠do"
}

Produto 5:
{
  "name": "Leite",
  "price": 4.50,
  "stock": 80,
  "description": "Leite integral"
}

---

2Ô∏è‚É£ LISTAR TODOS OS PRODUTOS
----------------------------
M√©todo: GET
URL: http://localhost:8000/products/

Resposta esperada: 200 OK
[
  {
    "id": 1,
    "name": "Arroz",
    "price": 10.5,
    "stock": 100,
    "description": "Arroz branco tipo 1"
  },
  {
    "id": 2,
    "name": "Feij√£o",
    "price": 8.0,
    "stock": 50,
    "description": "Feij√£o preto"
  }
]

---

3Ô∏è‚É£ BUSCAR PRODUTO POR ID
-------------------------
M√©todo: GET
URL: http://localhost:8000/products/1

Resposta esperada: 200 OK
{
  "id": 1,
  "name": "Arroz",
  "price": 10.5,
  "stock": 100,
  "description": "Arroz branco tipo 1"
}

Teste tamb√©m:
- GET /products/2
- GET /products/999 (deve retornar 404)

---

4Ô∏è‚É£ ATUALIZAR PRODUTO (atualiza√ß√£o parcial)
-------------------------------------------
M√©todo: PUT
URL: http://localhost:8000/products/1
Body (JSON) - Envie APENAS o que quer mudar:

Atualizar s√≥ o pre√ßo:
{
  "price": 12.00
}

Atualizar pre√ßo e estoque:
{
  "price": 11.50,
  "stock": 150
}

Atualizar tudo:
{
  "name": "Arroz Integral",
  "price": 15.00,
  "stock": 80,
  "description": "Arroz integral tipo 1"
}

Resposta esperada: 200 OK
{
  "id": 1,
  "name": "Arroz",
  "price": 12.0,
  "stock": 100,
  "description": "Arroz branco tipo 1"
}

---

5Ô∏è‚É£ DELETAR UM PRODUTO
----------------------
M√©todo: DELETE
URL: http://localhost:8000/products/1

Resposta esperada: 204 No Content
(sem corpo na resposta)

Teste tamb√©m:
- DELETE /products/999 (deve retornar 404)

================================================================================
                    üóëÔ∏è DELETAR M√öLTIPLOS PRODUTOS
================================================================================

6Ô∏è‚É£ DELETAR V√ÅRIOS PRODUTOS (POR LISTA DE IDs)
----------------------------------------------
M√©todo: DELETE
URL: http://localhost:8000/products/?products_ids=1&products_ids=2&products_ids=3

Ou de forma mais clara:
http://localhost:8000/products/?products_ids=2&products_ids=3&products_ids=4

Resposta esperada: 204 No Content

Se algum produto n√£o existir:
Resposta: 404 Not Found
{
  "detail": "Produto n√£o encontrado: [999, 888]"
}

DICA NO POSTMAN:
Adicione m√∫ltiplos Query Params:
- Key: products_ids | Value: 1
- Key: products_ids | Value: 2
- Key: products_ids | Value: 3

IMPORTANTE: A rota √© DELETE /products/ (com barra no final)
            N√ÉO confundir com DELETE /products/{id}

---

7Ô∏è‚É£ DELETAR PRODUTOS POR INTERVALO (RANGE)
------------------------------------------
M√©todo: DELETE
URL: http://localhost:8000/products/range?start_id=1&end_id=50

Deletar produtos de 1 a 50:
http://localhost:8000/products/range?start_id=1&end_id=50

Deletar produtos de 10 a 20:
http://localhost:8000/products/range?start_id=10&end_id=20

Deletar apenas o produto 5:
http://localhost:8000/products/range?start_id=5&end_id=5

Deletar produtos de 100 a 200:
http://localhost:8000/products/range?start_id=100&end_id=200

Resposta esperada: 204 No Content

ERROS POSS√çVEIS:
- start_id > end_id ‚Üí 400 Bad Request
  Exemplo: start_id=50&end_id=10
  Erro: "start_id (50) deve ser menor que ou igual ao end_id(10)"

- start_id < 1 ‚Üí 400 Bad Request
  Exemplo: start_id=0&end_id=10
  Erro: "start_id deve ser maior que 0"

- Nenhum produto no intervalo ‚Üí 404 Not Found
  Exemplo: start_id=999&end_id=1000 (produtos n√£o existem)
  Erro: "Nenhum produto encontrado no intervalo de 999 at√© 1000"

CASOS DE USO:
- Limpar banco de testes: start_id=1&end_id=1000
- Deletar lote espec√≠fico: start_id=50&end_id=100
- Remover produtos antigos: start_id=1&end_id=500

================================================================================
                    üîÑ MESCLAR PRODUTOS DUPLICADOS
================================================================================

8Ô∏è‚É£ MESCLAR PRODUTOS DUPLICADOS (SOMA ESTOQUE)
----------------------------------------------
M√©todo: POST
URL: http://localhost:8000/products/merge-duplicates?keep=first

‚ö†Ô∏è IMPORTANTE: Esta rota MODIFICA o banco de dados!
- Mant√©m UM produto de cada nome
- SOMA os estoques de todos os duplicados
- DELETA os produtos duplicados

---

OP√á√ÉO 1: Manter o PRIMEIRO produto (menor ID)
http://localhost:8000/products/merge-duplicates?keep=first

OP√á√ÉO 2: Manter o √öLTIMO produto (maior ID)
http://localhost:8000/products/merge-duplicates?keep=last

---

Resposta esperada: 200 OK
{
  "message": "24 produtos duplicados foram mesclados",
  "merged_count": 24,
  "kept": "first"
}

---

EXEMPLO PR√ÅTICO (keep=first):

ANTES da mesclagem:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID ‚îÇ Nome  ‚îÇ Pre√ßo   ‚îÇ Estoque ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 9  ‚îÇ Caf√©  ‚îÇ 15.00   ‚îÇ 30      ‚îÇ
‚îÇ 14 ‚îÇ Caf√©  ‚îÇ 15.00   ‚îÇ 30      ‚îÇ ‚Üê Duplicado
‚îÇ 19 ‚îÇ Caf√©  ‚îÇ 15.00   ‚îÇ 30      ‚îÇ ‚Üê Duplicado
‚îÇ 24 ‚îÇ Caf√©  ‚îÇ 15.00   ‚îÇ 30      ‚îÇ ‚Üê Duplicado
‚îÇ 29 ‚îÇ Caf√©  ‚îÇ 15.00   ‚îÇ 30      ‚îÇ ‚Üê Duplicado
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

DEPOIS da mesclagem (keep=first):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID ‚îÇ Nome  ‚îÇ Pre√ßo   ‚îÇ Estoque ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 9  ‚îÇ Caf√©  ‚îÇ 15.00   ‚îÇ 150     ‚îÇ ‚Üê Somou: 30+30+30+30+30
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

IDs deletados: 14, 19, 24, 29

---

EXEMPLO PR√ÅTICO (keep=last):

ANTES da mesclagem:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID ‚îÇ Nome  ‚îÇ Pre√ßo   ‚îÇ Estoque ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 11 ‚îÇ Arroz ‚îÇ 10.50   ‚îÇ 100     ‚îÇ
‚îÇ 16 ‚îÇ Arroz ‚îÇ 10.50   ‚îÇ 100     ‚îÇ ‚Üê Duplicado
‚îÇ 21 ‚îÇ Arroz ‚îÇ 10.50   ‚îÇ 100     ‚îÇ ‚Üê Duplicado
‚îÇ 26 ‚îÇ Arroz ‚îÇ 10.50   ‚îÇ 100     ‚îÇ ‚Üê Duplicado
‚îÇ 31 ‚îÇ Arroz ‚îÇ 10.50   ‚îÇ 100     ‚îÇ ‚Üê Duplicado
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

DEPOIS da mesclagem (keep=last):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID ‚îÇ Nome  ‚îÇ Pre√ßo   ‚îÇ Estoque ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 31 ‚îÇ Arroz ‚îÇ 10.50   ‚îÇ 500     ‚îÇ ‚Üê Manteve o √∫ltimo ID
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

IDs deletados: 11, 16, 21, 26

---

CASOS DE USO:
- Limpar banco de testes com produtos duplicados
- Consolidar produtos importados
- Corrigir erros de cadastro em massa

---

ERROS POSS√çVEIS:

1. Par√¢metro inv√°lido:
   URL: ?keep=middle
   Resposta: 400 Bad Request
   {
     "detail": "Par√¢metro 'keep' deve ser 'first' ou 'last' "
   }

2. Nenhum duplicado encontrado:
   Resposta: 404 Not Found
   {
     "detail": "Nenhum produto duplicado encontrado"
   }

---

‚ö†Ô∏è CUIDADO:
- Esta opera√ß√£o √© IRREVERS√çVEL!
- Fa√ßa backup do banco antes (copie market.db)
- Teste em ambiente de desenvolvimento primeiro
- Liste os produtos antes e depois para confirmar

---

PASSO A PASSO RECOMENDADO:

1. Listar produtos atuais:
   GET /products/

2. Identificar duplicados manualmente

3. Fazer backup:
   Copie o arquivo market.db

4. Executar mesclagem:
   POST /products/merge-duplicates?keep=first

5. Verificar resultado:
   GET /products/

6. Confirmar que estoques foram somados corretamente

================================================================================
                        üõí VENDAS (SALES)
================================================================================

9Ô∏è‚É£ CRIAR VENDA
---------------
M√©todo: POST
URL: http://localhost:8000/sales/
Body (JSON):
{
  "products": [
    {
      "product_id": 1,
      "quantity": 2
    },
    {
      "product_id": 2,
      "quantity": 1
    }
  ],
  "payment_method": "Dinheiro"
}

Resposta esperada: 201 Created
{
  "id": 1,
  "date": "2025-11-18T20:30:00",
  "total": 29.0,
  "payment_method": "Dinheiro"
}

---

EXEMPLOS ADICIONAIS DE VENDAS:

Venda com 1 produto:
{
  "products": [
    {
      "product_id": 3,
      "quantity": 5
    }
  ],
  "payment_method": "PIX"
}

Venda com 3 produtos:
{
  "products": [
    {
      "product_id": 1,
      "quantity": 1
    },
    {
      "product_id": 3,
      "quantity": 2
    },
    {
      "product_id": 5,
      "quantity": 3
    }
  ],
  "payment_method": "Cart√£o de Cr√©dito"
}

Venda grande (5 produtos diferentes):
{
  "products": [
    {"product_id": 1, "quantity": 2},
    {"product_id": 2, "quantity": 1},
    {"product_id": 3, "quantity": 5},
    {"product_id": 4, "quantity": 3},
    {"product_id": 5, "quantity": 4}
  ],
  "payment_method": "D√©bito"
}

---

üîü LISTAR TODAS AS VENDAS
--------------------------
M√©todo: GET
URL: http://localhost:8000/sales/

Resposta esperada: 200 OK
[
  {
    "id": 1,
    "date": "2025-11-18T20:30:00",
    "total": 29.0,
    "payment_method": "Dinheiro"
  },
  {
    "id": 2,
    "date": "2025-11-18T21:00:00",
    "total": 25.0,
    "payment_method": "PIX"
  }
]

---

1Ô∏è‚É£1Ô∏è‚É£ BUSCAR VENDA POR ID
-------------------------
M√©todo: GET
URL: http://localhost:8000/sales/1

Resposta esperada: 200 OK
{
  "id": 1,
  "date": "2025-11-18T20:30:00",
  "total": 29.0,
  "payment_method": "Dinheiro"
}

Teste tamb√©m:
- GET /sales/2
- GET /sales/999 (deve retornar 404)

================================================================================
                        üß™ ORDEM RECOMENDADA DE TESTES
================================================================================

SEQU√äNCIA B√ÅSICA:
-----------------
1. Criar 5 produtos diferentes (POST /products/)
2. Listar todos os produtos (GET /products/)
3. Buscar produto por ID (GET /products/1)
4. Atualizar pre√ßo de um produto (PUT /products/1)
5. Criar primeira venda (POST /sales/)
6. Listar todas as vendas (GET /sales/)
7. Buscar venda espec√≠fica (GET /sales/1)
8. Deletar um produto (DELETE /products/1)
9. Deletar v√°rios produtos de uma vez (DELETE /products/)
10. Deletar produtos por intervalo (DELETE /products/range)

TESTES COM DUPLICADOS:
----------------------
11. Criar produtos duplicados (POST /products/ v√°rias vezes com mesmo nome)
12. Listar e confirmar duplicados (GET /products/)
13. Mesclar duplicados (POST /products/merge-duplicates?keep=first)
14. Verificar que estoques foram somados (GET /products/)

TESTES AVAN√áADOS:
-----------------
15. Tentar criar produto com pre√ßo negativo (deve dar erro 422)
16. Tentar criar produto sem nome (deve dar erro 422)
17. Tentar buscar produto inexistente (deve dar 404)
18. Tentar criar venda com produto que n√£o existe (deve dar erro 400)
19. Tentar criar venda com quantidade maior que o estoque (deve dar erro 400)
20. Deletar produto e tentar busc√°-lo depois (deve dar 404)
21. Deletar intervalo com start_id > end_id (deve dar erro 400)
22. Deletar intervalo vazio (nenhum produto existe) (deve dar erro 404)
23. Tentar mesclar quando n√£o h√° duplicados (deve dar erro 404)
24. Tentar mesclar com par√¢metro inv√°lido (deve dar erro 400)

TESTES DE PERFORMANCE:
----------------------
25. Criar 100 produtos em sequ√™ncia
26. Listar todos os 100 produtos
27. Deletar todos de uma vez (range: 1-100)
28. Confirmar que todos foram deletados

================================================================================
                        üìä RESUMO COMPLETO DAS ROTAS
================================================================================

PRODUTOS:
---------
POST   /products/                           ‚Üí Criar produto
GET    /products/                           ‚Üí Listar todos
GET    /products/{id}                       ‚Üí Buscar por ID
PUT    /products/{id}                       ‚Üí Atualizar
POST   /products/merge-duplicates?keep=...  ‚Üí Mesclar duplicados ‚ú®
DELETE /products/{id}                       ‚Üí Deletar um
DELETE /products/?products_ids=1&...        ‚Üí Deletar v√°rios (lista)
DELETE /products/range?start_id=1&end_id=50 ‚Üí Deletar intervalo

VENDAS:
-------
POST   /sales/                              ‚Üí Criar venda
GET    /sales/                              ‚Üí Listar todas
GET    /sales/{id}                          ‚Üí Buscar por ID

DOCUMENTA√á√ÉO:
-------------
GET    /                                    ‚Üí Informa√ß√µes da API
GET    /health                              ‚Üí Status da API (health check)
GET    /docs                                ‚Üí Swagger UI (interface interativa)
GET    /redoc                               ‚Üí ReDoc (documenta√ß√£o alternativa)

================================================================================
                        FIM DO GUIA DE TESTES
================================================================================

üí° Dica: Sempre teste no Swagger (/docs) primeiro para ver a documenta√ß√£o
         interativa antes de usar o Postman!

üéØ Boa sorte nos testes! üöÄ

‚ö†Ô∏è Lembre-se: A rota /merge-duplicates deve estar ANTES de /{product_id}!

================================================================================